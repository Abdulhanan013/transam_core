<%= render 'index_subnav' %>

<div class="row-fluid">
	<div class="span12">
		<div id="timeline" class="well well-small" style="height:175px;"></div>
	</div>
</div>

<div class="row-fluid">
	<div class="span12">
		<table class="table table-condensed table-striped table-hover table-bordered">
			<thead>
				<tr>
					<th>Event</th>
					<th>Date</th>
					<th>Update</th>
					<th>Notes</th>
				</tr>
			</thead>
			<tbody>
				<% row = 1 %>
				<% @events.each do |e| %>
				<% row = row + 1 %>
				<tr data-action-path = '<%= inventory_asset_event_path(@asset, e) %>'>
					<td><%= e.asset_event_type.name %></td>
					<td><%= format_date(e.event_date) %></td>
					<td><%= e.get_update %></td>					
					<td><%= e.comments %></td>
				</tr>
				<% end %>
			</tbody>
		</table>
	</div>
</div>
<script type="text/javascript">

	google.load("visualization", "1");

	// Set callback to run when API is loaded
	google.setOnLoadCallback(draw_timeline);

	var timeline;

	// Called when a user mouses over a row
	function select_event(row) {
		timeline.setSelection([{row: row}])
	};

	// Called when the Visualization API is loaded.
	function draw_timeline() {

		// Create a JSON data table
		data = [
			<% @events.each do |e| %>
				{
				'start': new Date(<%= js_date(e.event_date) %>),
				'content': ' <%= e.asset_event_type.name %>'
				},
			<% end %>
			<% unless @asset.policy_replacement_year.nil? %>
				{
				'start': new Date(<%= js_year(@asset.policy_replacement_year) %>),
				'content': 'End of Useful Life'
				},
			<% end %>
			<% unless @asset.estimated_replacement_year.nil? %>
				{
				'start': new Date(<%= js_year(@asset.estimated_replacement_year) %>),
				'content': 'Est. End of Service'
				}
			<% end %>
		];
	
		// specify options
		options = {
			"width" : "100%",
			"height" : "100%",
			"style" : "box" // optional
		};
	
		// Instantiate our timeline object.
		timeline = new links.Timeline(document.getElementById('timeline'));
	
		// Draw our timeline with the created data and options
		timeline.draw(data, options);
	};

</script>
