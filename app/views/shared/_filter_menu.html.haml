:ruby
  my_filters = current_user.user_organization_filters.sorted
  my_personal_filters =  UserOrganizationFilter.joins(:users).where(created_by_user_id: current_user.id).group('user_organization_filters.id').having( 'count( user_id ) = 1' )

%ul.dropdown-menu.dropdown-menu-right{:role => "menu"}
  - (my_filters - my_personal_filters).each do |filter|
    - if filter == current_user.user_organization_filter
      %li.dropdown-submenu.dropdown-submenu-right
        = link_to user_user_organization_filter_use_path(current_user, filter) do
          %i.fa.fa-filter.fa-fw
          = filter.name
          -#%span{style: 'color: red;'}= 1 == 1  ? 'Selected' : ''
        %ul.dropdown-menu{style: "overflow-y:scroll;height:400px;"}
          - orgs = current_user.user_organization_filter.query_string.present? ? TransitOperator.find_by_sql(current_user.user_organization_filter.query_string) : current_user.user_organization_filter.organizations
          - orgs.each do |org|
            %li
              -#= link_to user_user_organization_filter_set_org_path(current_user, current_user.user_organization_filter, org: org.short_name) do
              = link_to '#' do
                %i.fa.fa-filter.fa-fw
                = org.short_name
                -#%span{style: 'color: red;'}= 1 == 1  ? 'Selected' : ''
    - else
      %li
        = link_to user_user_organization_filter_use_path(current_user, filter) do
          %i.fa.fa-filter.fa-fw
          = filter.name
  %li.divider
  - my_personal_filters.each do |filter|
    %li
      = link_to user_user_organization_filter_use_path(current_user, filter) do
        %i.fa.fa-filter.fa-fw
        = filter.name
  %li.divider
  %li.text-left
    = link_to user_user_organization_filters_path(current_user) do
      %i.fa.fa-list-alt.fa-fw
      Manage Filters
  %li.divider
  %li.text-left
    = link_to new_user_user_organization_filter_path(current_user) do
      %i.fa.fa-plus.fa-fw
      New Filter