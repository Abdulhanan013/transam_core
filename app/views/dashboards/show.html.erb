<div class="row-fluid">
	<div class="well well-small span12">
		<div id="chart"></div>
	</div>
</div>
<div class="row-fluid">
	<div class="span12">
		<table class="table table-condensed table-striped table-hover table-bordered">
			<thead>
				<tr>
					<% @chart_data[:labels].each do |col| %>
					<th><%= col %></th>
					<% end %>
				</tr>
			</thead>
			<tbody>
				<% @chart_data[:data].each do |row| %>
				<tr>
					<% row.each do |col| %>
					<td><%= col %></td>
					<% end %>
				</tr>
				<% end %>
			</tbody>
		</table>
	</div>
</div>
<script type="text/javascript">

	google.load("visualization", "1", {
		packages : ["corechart"]
	});

	var chart_type = <%= @type.to_json %>;
	google.setOnLoadCallback(draw_chart);

	function draw_chart() {

		var chart_data = new google.visualization.DataTable();

		chart_data.addColumn('string', '<%= @chart_data[:labels].first %>');
		<% @chart_data[:labels].last(@chart_data[:labels].length - 1).each do |col| %>
		chart_data.addColumn('number', '<%= col %>');
		<% end %>
		<% @chart_data[:data].each do |row| %>
		chart_data.addRow(<%= raw row.to_json %>);
		<% end %>
		
		var chart_options = null;
		var chart = null;
		if (chart_type == 1 || chart_type == 2) {
			chart_options = {
				is3D : true,
				height : 300
			};
			chart = new google.visualization.PieChart(document.getElementById('chart'));
		} else if (chart_type == 3) {
			chart_options = {
				hAxis : {
					title : 'Age (years)'
				},
				isStacked : true,
				height : 300
			};
			chart = new google.visualization.ColumnChart(document.getElementById('chart'));
		} else if (chart_type == 4) {
			chart_options = {
				vAxis : {
					title : 'Backlog ($K)'
				},
				height : 300,
				legend : {
					position : 'none'
				}
			};
			chart = new google.visualization.ColumnChart(document.getElementById('chart'));
		} else if (chart_type == 5) {
			chart_options = {
				hAxis : {
					title : 'Year'
				},
				vAxis : {
					title : 'Needs ($K)'
				},
				isStacked : true,
				height : 300
			};
			chart = new google.visualization.ColumnChart(document.getElementById('chart'));
		}

		chart.draw(chart_data, chart_options);
	}
	
	// Handle the resize event and make sure the chart is redrawn for the new size
	window.onresize = function() {
		draw_chart();
	};

</script>

