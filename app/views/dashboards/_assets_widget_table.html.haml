- level ||= 'subtype'

%table.table.table-hover.table-condensed{style: 'width:100%;'}
  %thead
    %tr
      %th.left.nowrap{:data => {:sortable => 'true'}}= level == 'type' ? 'Type' : 'Subtype'
      %th.left.nowrap{:data => {:sortable => 'true'}} Avg. Age
      %th.left.nowrap{:data => {:sortable => 'true'}} Count
      %th.left.nowrap{:data => {:sortable => 'true'}} Cost
      %th.left.nowrap{:data => {:sortable => 'true'}} Book Value

  %tbody
    - results.each do |a|
      - if level == 'subtype'
        - assets = Asset.where(organization_id: a['organization_id'], asset_subtype_id: a['asset_subtype_id'])
      - else
        - assets = Asset.joins(asset_subtype: :asset_type).where(organization_id: a['organization_id']).where('asset_subtypes.asset_type_id = ?', a['asset_type_id'])
      %tr
        - if @organization_list.count > 1
          %td.left= "#{a['org_short_name']} #{a['subtype_name']}"
        - else
          %td.left= a['subtype_name']
        %td.right= format_as_decimal((assets.inject(0) { |sum, x| sum += x.age }/assets.count.to_f),1)
        %td.right= a['assets_count']
        %td.right= format_as_currency(a['sum_purchase_cost'])
        %td.right= format_as_currency(a['sum_book_value'])
